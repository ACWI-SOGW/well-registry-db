FROM usgswma/iow_test_db:postgis11-jre11

LABEL maintainer=gs-w_eto_eb_federal_employees@usgs.gov

ARG DEFAULT_PASSWORD=changeMe
ARG DEFAULT_DATABASE_NAME=well_registry
ARG DEFAULT_DATABASE_ADDRESS=127.0.0.1
ARG DEFAULT_DB_OWNER_USERNAME=well_registry_owner
ARG DEFAULT_DB_OWNER_PASSWORD=appOwnerChangeme
ARG DEFAULT_SCHEMA_OWNER_USERNAME=registry_owner
ARG DEFAULT_SCHEMA_OWNER_PASSWORD=registryOwnerChangeme
ARG DEFAULT_SCHEMA_NAME=registry

ARG POSTGRES_PASSWORD="${DEFAULT_PASSWORD}"
ENV POSTGRES_PASSWORD="${POSTGRES_PASSWORD}"

ARG DATABASE_HOST="${DEFAULT_DATABASE_ADDRESS}"
ENV DATABASE_HOST="${DATABASE_HOST}"

ARG APP_DATABASE_NAME="${DEFAULT_DATABASE_NAME}"
ENV APP_DATABASE_NAME="${APP_DATABASE_NAME}"

ARG APP_DB_OWNER_USERNAME="${DEFAULT_DB_OWNER_USERNAME}"
ENV APP_DB_OWNER_USERNAME="${APP_DB_OWNER_USERNAME}"

ARG APP_DB_OWNER_PASSWORD="${DEFAULT_DB_OWNER_PASSWORD}"
ENV APP_DB_OWNER_PASSWORD="${APP_DB_OWNER_PASSWORD}"

ARG APP_SCHEMA_NAME=${DEFAULT_SCHEMA_NAME}
ENV APP_SCHEMA_NAME="${APP_SCHEMA_NAME}"

ARG APP_SCHEMA_OWNER_USERNAME=${DEFAULT_SCHEMA_OWNER_USERNAME}
ENV APP_SCHEMA_OWNER_USERNAME="${APP_SCHEMA_OWNER_USERNAME}"

ARG APP_SCHEMA_OWNER_PASSWORD="${DEFAULT_SCHEMA_OWNER_PASSWORD}"
ENV APP_SCHEMA_OWNER_PASSWORD="${APP_SCHEMA_OWNER_PASSWORD}"

############################################
# Grab files for initializing the database
############################################

COPY ./liquibase/changeLogs $LIQUIBASE_WORKSPACE
COPY ./liquibase/scripts/*.sh /docker-entrypoint-initdb.d/
COPY ./liquibase/scripts/dbInit /docker-entrypoint-initdb.d/
